
generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =====================================
// ENUMS
// =====================================

enum EventType {
  forum
  workshop
  conference
  networking
  webinar
  other
}

enum EventStatus {
  draft
  published
  ongoing
  completed
  cancelled
}

enum BlogPostStatus {
  draft
  published
  archived
}

enum JobType {
  stage
  cdi
  cdd
  freelance
  alternance
}

enum JobStatus {
  draft
  published
  closed
  filled
}

enum ExperienceLevel {
  none
  beginner
  intermediate
  advanced
  junior
  senior
  expert
}

enum EducationLevel {
  bac
  bac_plus_2
  bac_plus_3
  bac_plus_5
  phd
}

enum SalaryPeriod {
  hour
  day
  month
  year
}

enum RegistrationStatus {
  pending
  confirmed
  cancelled
  attended
}

enum PaymentStatus {
  pending
  paid
  refunded
  exempted
}

enum ContactCategory {
  general
  technical
  press
  event
  career
}

enum MessageStatus {
  new
  in_progress
  resolved
  closed
}

enum Priority {
  low
  normal
  high
  urgent
}

enum CompanySize {
  startup
  pme
  eti
  grande_entreprise
}

enum MediaType {
  image
  video
}

enum NewsletterFrequency {
  daily
  weekly
  monthly
}

enum AdminRole {
  super_admin
  admin
  viewer
}

// =====================================
// BLOG MANAGEMENT
// =====================================

model BlogCategory {
  id          Int         @id @default(autoincrement())
  name        String
  slug        String      @unique
  description String?
  color       String      @default("#10B981")
  icon        String?
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  
  posts       BlogPost[]

  @@index([slug])
  @@index([isActive])
  @@map("blog_categories")
}

model BlogPost {
  id                Int              @id @default(autoincrement())
  title             String
  slug              String           @unique
  excerpt           String?
  content           String
  featuredImage     String?
  authorName        String
  authorPosition    String?
  categoryId        Int
  status            BlogPostStatus   @default(draft)
  isFeatured        Boolean          @default(false)
  readTimeMinutes   Int              @default(5)
  viewsCount        Int              @default(0)
  likesCount        Int              @default(0)
  metaTitle         String?
  metaDescription   String?
  publishedAt       DateTime?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  
  category          BlogCategory     @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  tags              BlogPostTag[]

  @@index([slug])
  @@index([status])
  @@index([isFeatured])
  @@index([publishedAt])
  @@map("blog_posts")
}

model BlogTag {
  id          Int           @id @default(autoincrement())
  name        String
  slug        String        @unique
  color       String        @default("#10B981")
  usageCount  Int           @default(0)
  createdAt   DateTime      @default(now())
  
  posts       BlogPostTag[]

  @@index([slug])
  @@map("blog_tags")
}

model BlogPostTag {
  id        Int      @id @default(autoincrement())
  postId    Int
  tagId     Int
  createdAt DateTime @default(now())
  
  post      BlogPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag       BlogTag  @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([postId, tagId])
  @@map("blog_post_tags")
}

// =====================================
// EVENTS MANAGEMENT
// =====================================

model Event {
  id                  Int           @id @default(autoincrement())
  title               String
  slug                String        @unique
  description         String?
  shortDescription    String?
  featuredImage       String?
  eventType           EventType
  location            String?
  isVirtual           Boolean       @default(false)
  virtualLink         String?
  startDate           DateTime
  endDate             DateTime
  registrationStart   DateTime?
  registrationEnd     DateTime?
  maxParticipants     Int?
  currentParticipants Int           @default(0)
  isFree              Boolean       @default(true)
  price               Float         @default(0)
  currency            String        @default("MAD")
  status              EventStatus   @default(draft)
  isFeatured          Boolean       @default(false)
  organizerName       String
  agenda              String?       // JSON string
  speakers            String?       // JSON string
  sponsors            String?       // JSON string
  requirements        String?
  whatToBring         String?
  registrationLink String?
  metaTitle           String?
  metaDescription     String?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt

  // Relations
  videos              VideoGallery[]
  photos              PhotoGallery[]

  @@index([slug])
  @@index([eventType])
  @@index([startDate])
  @@index([status])
  @@index([isFeatured])
  @@map("events")
}



// =====================================
// JOB OFFERS
// =====================================

model JobOffer {
  id                  Int             @id @default(autoincrement())
  title               String
  slug                String          @unique
  companyName         String
  companyLogo         String?
  companyWebsite      String?
  industry            String?
  jobType             String?         // Changed from JobType enum to optional string
  location            String?
  isRemote            Boolean?        // Changed to optional
  salaryMin           Float?
  salaryMax           Float?
  salaryCurrency      String?         // Changed to optional
  salaryPeriod        String?         // Changed from SalaryPeriod enum to optional string
  description         String?         // Changed to optional
  requirements        String?         // JSON string for tags
  benefits            String?         // JSON string for tags
  applicationEmail    String?
  applicationUrl      String?
  applicationPhone    String?
  applicationDeadline DateTime?
  experienceRequired  String?         // Changed from ExperienceLevel enum to optional string
  educationLevel      String?         // Changed from EducationLevel enum to optional string
  contractDuration    String?
  startDate           DateTime?
  skillsRequired      String?         // JSON string for tags
  languagesRequired   String?         // JSON string for tags
  status              String?         // Changed from JobStatus enum to optional string
  isFeatured          Boolean?        // Changed to optional
  viewsCount          Int             @default(0)
  publishedAt         DateTime?
  expiresAt           DateTime?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  @@index([slug])
  @@index([jobType])
  @@index([location])
  @@index([status])
  @@index([companyName])
  @@index([publishedAt])
  @@map("job_offers")
}

// =====================================
// CONTACT
// =====================================

model ContactMessage {
  id          Int             @id @default(autoincrement())
  name        String
  email       String
  phone       String?
  subject     String
  message     String
  category    ContactCategory @default(general)
  status      MessageStatus   @default(new)
  priority    Priority        @default(normal)
  adminNotes  String?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  resolvedAt  DateTime?

  @@index([email])
  @@index([status])
  @@index([category])
  @@index([createdAt])
  @@map("contact_messages")
}

// =====================================
// VIDEO TESTIMONIALS
// =====================================

model VideoTestimonial {
  id               Int      @id @default(autoincrement())
  name             String
  position         String?
  company          String?
  graduationYear   Int?
  videoUrl         String   // YouTube URL (any format) - will be converted to embed
  thumbnailUrl     String?  // Optional custom thumbnail, falls back to YouTube default
  quote            String?  // Short quote for cards
  fullTranscript   String?  // Full testimonial text
  isFeatured       Boolean  @default(false)
  isActive         Boolean  @default(true)
  sortOrder        Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([isFeatured])
  @@index([isActive])
  @@index([sortOrder])
  @@map("video_testimonials")
}

// =====================================
// GALLERY (VIDEOS & PHOTOS)
// =====================================

// Gallery for YouTube unlisted videos (no API needed)
model VideoGallery {
  id            Int      @id @default(autoincrement())
  title         String
  description   String?
  videoUrl      String   // YouTube URL (unlisted videos)
  thumbnailUrl  String?  // Optional custom thumbnail
  eventId       Int?     // Link to Event
  eventName     String?  // Event name (fallback if no eventId)
  eventYear     Int?     // Year (e.g., 2025)
  category      String?  // Category (e.g., "Forum", "Conf√©rence", "Atelier")
  isActive      Boolean  @default(true)
  isFeatured    Boolean  @default(false)
  sortOrder     Int      @default(0)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  event         Event?   @relation(fields: [eventId], references: [id], onDelete: SetNull)

  @@index([eventId])
  @@index([eventYear])
  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@index([sortOrder])
  @@map("video_gallery")
}

// Gallery for Google Drive photos (direct links, no API)
model PhotoGallery {
  id            Int      @id @default(autoincrement())
  title         String
  description   String?
  imageUrl      String   // Direct Google Drive image URL (uc?export=view&id=...)
  thumbnailUrl  String?  // Optional smaller thumbnail URL
  eventId       Int?     // Link to Event
  eventName     String?  // Event name (fallback if no eventId)
  eventYear     Int?     // Year
  category      String?  // Category
  isActive      Boolean  @default(true)
  isFeatured    Boolean  @default(false)
  sortOrder     Int      @default(0)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  event         Event?   @relation(fields: [eventId], references: [id], onDelete: SetNull)

  @@index([eventId])
  @@index([eventYear])
  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@index([sortOrder])
  @@map("photo_gallery")
}

// =====================================
// AUTHENTICATION (Better Auth)
// =====================================

model User {
  id            String    @id
  name          String
  email         String    @unique
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Champs additionnels pour admin
  role          String    @default("viewer")
  fullName      String
  isActive      Boolean   @default(true)
  lastLogin     DateTime?

  sessions      Session[]
  accounts      Account[]

  @@index([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("session")
}

model Account {
  id                String  @id
  accountId         String
  providerId        String
  userId            String
  accessToken       String?
  refreshToken      String?
  idToken           String?
  accessTokenExpiresAt DateTime?
  refreshTokenExpiresAt DateTime?
  scope             String?
  password          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, value])
  @@map("verification")
}